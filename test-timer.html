<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="TabbyMansion - ì§‘ì¤‘ ì‘ì—…ì„ ìœ„í•œ íƒ€ì´ë¨¸ & íƒ­ ì¶”ì ê¸°"
    />
    <meta name="theme-color" content="#667eea" />
    <title>TabbyMansion ê³µìœ  íƒ€ì´ë¨¸ í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
        color: #ffd700;
      }

      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
      }

      .test-section h2 {
        color: #ffd700;
        margin-bottom: 15px;
      }

      .test-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .test-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .test-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .status {
        margin-top: 15px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        font-family: monospace;
        font-size: 12px;
      }

      .instructions {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .instructions h3 {
        color: #ffd700;
        margin-bottom: 10px;
      }

      .instructions ul {
        margin: 0;
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>â±ï¸ TabbyMansion ê³µìœ  íƒ€ì´ë¨¸ í…ŒìŠ¤íŠ¸</h1>

      <div class="instructions">
        <h3>í…ŒìŠ¤íŠ¸ ë°©ë²•:</h3>
        <ul>
          <li>Chrome Extensionì„ ì„¤ì¹˜í•˜ê³  í™œì„±í™”í•˜ì„¸ìš”</li>
          <li>Extension íŒì—…ì—ì„œ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘/ì¼ì‹œì •ì§€/ë¦¬ì…‹í•´ë³´ì„¸ìš”</li>
          <li>ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì¼í•œ íƒ€ì´ë¨¸ ìƒíƒœê°€ ê³µìœ ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</li>
          <li>ë¸Œë¼ìš°ì €ë¥¼ ì¬ì‹œì‘í•œ í›„ íƒ€ì´ë¨¸ ìƒíƒœê°€ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</li>
        </ul>
      </div>

      <div class="test-section">
        <h2>ğŸ”§ ë°±ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-buttons">
          <button class="test-btn" onclick="testTimerGet()">
            íƒ€ì´ë¨¸ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
          </button>
          <button class="test-btn" onclick="testTimerStart()">
            íƒ€ì´ë¨¸ ì‹œì‘
          </button>
          <button class="test-btn" onclick="testTimerPause()">
            íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€
          </button>
          <button class="test-btn" onclick="testTimerReset()">
            íƒ€ì´ë¨¸ ë¦¬ì…‹
          </button>
        </div>
        <div class="status" id="status">ìƒíƒœ: ëŒ€ê¸° ì¤‘...</div>
      </div>

      <div class="test-section">
        <h2>ğŸ“Š ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-buttons">
          <button class="test-btn" onclick="testStorageGet()">
            ìŠ¤í† ë¦¬ì§€ ì½ê¸°
          </button>
          <button class="test-btn" onclick="testStorageSet()">
            ìŠ¤í† ë¦¬ì§€ ì“°ê¸°
          </button>
        </div>
        <div class="status" id="storage-status">ìŠ¤í† ë¦¬ì§€ ìƒíƒœ: ëŒ€ê¸° ì¤‘...</div>
      </div>

      <div class="test-section">
        <h2>ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-buttons">
          <button class="test-btn" onclick="startRealtimeTest()">
            ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œì‘
          </button>
          <button class="test-btn" onclick="stopRealtimeTest()">
            ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì¤‘ì§€
          </button>
        </div>
        <div class="status" id="realtime-status">ì‹¤ì‹œê°„ ìƒíƒœ: ëŒ€ê¸° ì¤‘...</div>
      </div>
    </div>

    <script>
      let realtimeInterval = null;

      // íƒ€ì´ë¨¸ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
      async function testTimerGet() {
        try {
          const response = await chrome.runtime.sendMessage({
            action: "TIMER_GET",
          });
          document.getElementById(
            "status"
          ).textContent = `íƒ€ì´ë¨¸ ìƒíƒœ: ${JSON.stringify(response, null, 2)}`;
        } catch (error) {
          document.getElementById(
            "status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // íƒ€ì´ë¨¸ ì‹œì‘
      async function testTimerStart() {
        try {
          const response = await chrome.runtime.sendMessage({
            action: "TIMER_START",
            label: "í…ŒìŠ¤íŠ¸ íƒ€ì´ë¨¸",
          });
          document.getElementById(
            "status"
          ).textContent = `íƒ€ì´ë¨¸ ì‹œì‘: ${JSON.stringify(response, null, 2)}`;
        } catch (error) {
          document.getElementById(
            "status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€
      async function testTimerPause() {
        try {
          const response = await chrome.runtime.sendMessage({
            action: "TIMER_PAUSE",
          });
          document.getElementById(
            "status"
          ).textContent = `íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€: ${JSON.stringify(
            response,
            null,
            2
          )}`;
        } catch (error) {
          document.getElementById(
            "status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // íƒ€ì´ë¨¸ ë¦¬ì…‹
      async function testTimerReset() {
        try {
          const response = await chrome.runtime.sendMessage({
            action: "TIMER_RESET",
          });
          document.getElementById(
            "status"
          ).textContent = `íƒ€ì´ë¨¸ ë¦¬ì…‹: ${JSON.stringify(response, null, 2)}`;
        } catch (error) {
          document.getElementById(
            "status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // ìŠ¤í† ë¦¬ì§€ ì½ê¸°
      async function testStorageGet() {
        try {
          const result = await chrome.storage.local.get(["timerState"]);
          document.getElementById(
            "storage-status"
          ).textContent = `ìŠ¤í† ë¦¬ì§€ ì½ê¸°: ${JSON.stringify(result, null, 2)}`;
        } catch (error) {
          document.getElementById(
            "storage-status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // ìŠ¤í† ë¦¬ì§€ ì“°ê¸°
      async function testStorageSet() {
        try {
          const testData = {
            status: "paused",
            startedAt: null,
            accumulatedMs: 0,
            label: "í…ŒìŠ¤íŠ¸ ë°ì´í„°",
          };
          await chrome.storage.local.set({ timerState: testData });
          document.getElementById(
            "storage-status"
          ).textContent = `ìŠ¤í† ë¦¬ì§€ ì“°ê¸° ì™„ë£Œ: ${JSON.stringify(
            testData,
            null,
            2
          )}`;
        } catch (error) {
          document.getElementById(
            "storage-status"
          ).textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
      }

      // ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œì‘
      function startRealtimeTest() {
        if (realtimeInterval) {
          clearInterval(realtimeInterval);
        }

        realtimeInterval = setInterval(async () => {
          try {
            const response = await chrome.runtime.sendMessage({
              action: "TIMER_GET",
            });
            const now = new Date().toLocaleTimeString();
            document.getElementById(
              "realtime-status"
            ).textContent = `[${now}] ì‹¤ì‹œê°„ ìƒíƒœ: ${JSON.stringify(
              response.state,
              null,
              2
            )}`;
          } catch (error) {
            document.getElementById(
              "realtime-status"
            ).textContent = `ì‹¤ì‹œê°„ ì˜¤ë¥˜: ${error.message}`;
          }
        }, 1000);

        document.getElementById("realtime-status").textContent =
          "ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œì‘ë¨ (1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸)";
      }

      // ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì¤‘ì§€
      function stopRealtimeTest() {
        if (realtimeInterval) {
          clearInterval(realtimeInterval);
          realtimeInterval = null;
        }
        document.getElementById("realtime-status").textContent =
          "ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨";
      }

      // ìŠ¤í† ë¦¬ì§€ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
      chrome.storage.onChanged.addListener((changes, namespace) => {
        if (namespace === "local" && changes.timerState) {
          const now = new Date().toLocaleTimeString();
          document.getElementById(
            "storage-status"
          ).textContent = `[${now}] ìŠ¤í† ë¦¬ì§€ ë³€ê²½ ê°ì§€: ${JSON.stringify(
            changes.timerState.newValue,
            null,
            2
          )}`;
        }
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ í™•ì¸
      window.addEventListener("load", () => {
        testTimerGet();
        testStorageGet();
      });
    </script>
  </body>
</html>
